<DOCTYPE html>
<html>
	<head>
		<title>Monthrob appreciation page</title>
		<!-- Monflake effect -->
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"></script>
		<script type="text/javascript" src="gravity.js"></script>
		<script type="text/javascript" src="snow.js"></script>
		<script type="text/javascript">
			var input = "";
			var timer;
			var mode = false;
			$(function() {
				today = new Date();
				var snowImage = "http://dl.dropboxusercontent.com/u/86028039/monthrob_x64.gif";
				if (today.getDate() == 14 && today.getMonth() == 1) {
					snowImage = "http://www.i2symbol.com/images/symbols/love/white_heart_suit_u2661_icon_64x64.png";
				}
				if (0) {
				$(document).snow({
					SnowImage: snowImage,
					Quantity: 10
				});
				}
			});
			$(document).keyup(function(e) {
				//alert(e.which);
				input += e.which;    
				    
				clearTimeout(timer);
				timer = setTimeout(function() { input = ""; }, 200);
				    
				check_input();
			});

			function check_input() {
				if(input == "71") {
					//display the search bar
					el = document.getElementById("searchbar");
					el.style.display = 'block';
					el.style.visibility = 'visible';
					document.getElementById("googleInput").focus();
				}
				if (input == "72736869") {
					//display the search bar
					el = document.getElementById("searchbar");
					el.style.display = 'none';
					el.style.visibility = 'hidden';
					gi = document.getElementById("googleInput");
					if (gi.value != '') {
						gi.value = '';
					}
					gi.blur();
				}
			}
			

Simulation = function () { 
	this.elements =[];
	this.bottom = new Gravity.Vector(-1,-1);
	this.top    = new Gravity.Vector(1,1);
	this.G = 1e-5
	this.sun_mass = 10000;
	this.max_r = 2;
	this.elastic_factor  = 1;
	this.max_speed   = 0.1;
	this.slowdown_factor = 1;
	
}



Simulation.prototype = {
	addBody: function (id,  mass, pos, vel) {
		this.elements.push ({
			id: id, 
			body: new Gravity.Body(mass, pos, vel)
		})
	},
	iterate: function(time) {
		//  Force relative to position from origin
		for (var i in this.elements) {
			var body = this.elements[i].body;
			//  Gravitational pull
			// Kind of m1*m1*G / r^2
			var body_mass = body.mass
			var factor = body_mass * this.sun_mass * this.G;
			var r = body.position.modulus();
			var force = body.position.scale(-1).direction().scale(factor/(r*r));
			body.addForce(force);
			//  Also add a elastic force to bring it back
			if (r > this.max_r) {
				var elastic_force = body.position.scale(-1).scale(this.elastic_factor);
				body.addForce(elastic_force);
				
			}
			// Also retadr it if is it too fast 
			var speed = body.velocity.modulus()
			if (speed > this.max) {
				var slowdown_force = body.velocity.scale(-1).scale(this.slowdown_factor);
				body.addForce(slowdown_force);
			}
			body.newFrame(time);
		}
	},
	paint: function () {
		move("mainmon",500-320/2,500-323/2);
		for (i in this.elements) {
			var id = this.elements[i].id;
			var body = this.elements[i].body;
			var coors = body.viewportCoord(0,0,1000,1000,this.bottom,this.top); 
			move(id,coors.rows, coors.cols);
		}
	}
}

var sim;

function setup () {
	sim = new Simulation();
	sim.addBody("minimon1",2,new Gravity.Vector(0.5,0),new Gravity.Vector(0.0,0.5));
	sim.addBody("minimon2",3,new Gravity.Vector(0,1),new Gravity.Vector(-0.25,0));
	sim.addBody("minimon3",1,new Gravity.Vector(0,0.5),new Gravity.Vector(-0.5,0));
	sim.addBody("minimon4",5,new Gravity.Vector(-0.5,-0.5),new Gravity.Vector(-0.25,0.25));
	sim.addBody("minimon5",10,new Gravity.Vector(-1,1),new Gravity.Vector(0.1,0));
	sim.paint();
	
	var frame_rate = 20
	var speedup = 4
	
	var interval = 1/frame_rate;
	setInterval(function (){iterate(interval*speedup)},interval*1000);
}

function iterate(time) {
	sim.iterate(time);
	sim.paint();
}

function move (id, rows, cols) {
		var el = document.getElementById(id);
		el.style.top = rows + "px";
		el.style.left  = cols + "px";
}
			
		</script>
		<link rel="stylesheet" href="monthrob.css" />	
		<!-- End of Monflake -->
	</head>
	<body >
		<div id="stage">
			<img id="mainmon" class="mainmon" src="https://dl.dropboxusercontent.com/u/15086336/CDN/throb.gif" alt="monthrob"></img>
			<img id="minimon1" class="minimon" src="http://dl.dropboxusercontent.com/u/86028039/monthrob_x64.gif" alt="minithrob"></img>
			<img id="minimon2" class="minimon" src="http://dl.dropboxusercontent.com/u/86028039/monthrob_x64.gif" alt="minithrob"></img>
			<img id="minimon3" class="minimon" src="http://dl.dropboxusercontent.com/u/86028039/monthrob_x64.gif" alt="minithrob"></img>
			<img id="minimon4" class="minimon" src="http://dl.dropboxusercontent.com/u/86028039/monthrob_x64.gif" alt="minithrob"></img>
			<img id="minimon5" class="minimon" src="http://dl.dropboxusercontent.com/u/86028039/monthrob_x64.gif" alt="minithrob"></img>
			<div id="searchbar" style="display: none; visibility: hidden; text-align: center; vertical-align: middle;">
				<form method="get" action="http://www.google.com/search">
					<input id="googleInput" type="text" name="q" size="65" maxlength="255" value=""/>
					<input type="submit" value="Monthrob Search" />
				</form>
			</div>
		</div>
		<div id="footer">
			<div id="animatedcopyright" style="display: block;" class="rubberBand animated"><h2 class="copyright">&copy; 2015 The Monish</h2></span>
		</div>
		<script type="text/javascript">
			colors = ["LightGreen","DarkSalmon", "LightSkyBlue", "White", "LightGoldenRodYellow ", "#99FFFF", "#FF99AA"];
			var num_colors = colors.length;
			color_num = Math.floor(Math.random() * num_colors);
			document.body.style.backgroundColor = colors[color_num];
			setup();
			</script>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-59768168-1', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>
